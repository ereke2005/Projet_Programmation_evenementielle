{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tableau de bord Ã©tudiant</title>
    <link rel="stylesheet" href="{% static 'css/student_dashboard.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
 
    <header class="dashboard-header">
        <div class="header-content">
            <h1>ğŸ‘©â€ğŸ“ Bienvenue, {{ user.username }} !</h1>
            <p class="student-level">Niveau : {{ user.student_profile.level }}</p>
            <a href="{% url 'logout' %}" class="logout-btn">Se dÃ©connecter</a>
        </div>
    </header>

    <main class="dashboard-main">

        <section class="custom-session-requests">
            <h2>ğŸ“Œ Mes demandes de session personnalisÃ©e</h2>
            {% if demandes_personnalisees %}
                <ul class="custom-request-list">
                    {% for demande in demandes_personnalisees %}
                        <li>
                            <strong>Sujet :</strong> {{ demande.subject }}<br>
                            <strong>DÃ©tails :</strong> {{ demande.details }}<br>
                            <em>EnvoyÃ©e le {{ demande.submitted_at|date:"d M Y H:i" }}</em>
                            <form method="POST" action="{% url 'delete_custom_request' demande.id %}" style="margin-top: 10px;">
                                {% csrf_token %}
                                <button type="submit" class="btn-delete">ğŸ—‘ï¸ Supprimer la demande</button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Vous n'avez pas encore envoyÃ© de demande personnalisÃ©e.</p>
            {% endif %}
        </section>
        <section class="resources">
            <h2> Ressources recommandÃ©es</h2>
            <ul class="resource-links">
                <li><a href="{% url 'videos_list' %}"> Voir les vidÃ©os pÃ©dagogiques</a></li>
                <li><a href="{% url 'quiz_lists' %}"> Participer Ã  un quiz</a></li>
                <li><a href="{% url 'demande_session' %}"> Demander une session personnalisÃ©e</a></li>
            </ul>
        </section>

        <section class="upcoming-sessions">
            <h2> Mes sessions Ã  venir</h2>
            {% if sessions_inscrites %}
                <ul class="session-list">
                    {% for session in sessions_inscrites %}
                        <li class="session-item">
                            <strong>{{ session.topic }}</strong><br>
                            ğŸ—“ï¸ Du {{ session.start_time|date:"d M Y H:i" }} au {{ session.end_time|date:"d M Y H:i" }}<br>
                            ğŸ‘¨â€ğŸ« Mentor : {{ session.mentor.user.username }}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Aucune session programmÃ©e pour le moment.</p>
            {% endif %}
        </section>

        <section class="public-sessions">
            <h2> Sessions ouvertes Ã  tous</h2>
            {% if sessions_publiques %}
                <ul class="session-list">
                    {% for session in sessions_publiques %}
                        <li class="session-item">
                            <strong>{{ session.topic }}</strong><br>
                            ğŸ‘¨â€ğŸ« Mentor : {{ session.mentor.user.username }}<br>
                            ğŸ—“ï¸ Du {{ session.start_time|date:"d M Y H:i" }} au {{ session.end_time|date:"d M Y H:i" }}<br>

                            {% if session.id in sessions_postulees_ids %}
                                <form method="POST" action="{% url 'cancel_application' session.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn-cancel">âŒ Annuler la participation</button>
                                </form>
                            {% else %}
                                <form method="POST" action="{% url 'apply_to_session' session.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn-apply">âœ… Je souhaite participer</button>
                                </form>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Aucune session publique disponible actuellement.</p>
            {% endif %}
        </section>

        
        <section class="mentorship-requests">
            <h2> Demandes de mentorat</h2>
            {% if mentorships %}
                <form method="POST" action="{% url 'apply_to_mentorship' %}">
                    {% csrf_token %}
                    <ul class="mentorship-list">
                        {% for request in mentorships %}
                            <li>
                                <label class="mentorship-item">
                                    <input type="checkbox" name="mentorship_requests" value="{{ request.id }}"
                                        {% if request.id in mentorships_applied_ids %}checked disabled{% endif %}>
                                    <strong>Domaine :</strong> {{ request.interest }}<br>
                                    <strong>Langue :</strong> {{ request.language }}<br>
                                    <strong>Fuseau horaire :</strong> {{ request.time_zone }}<br>
                                    <em>{{ request.notes }}</em>
                                    {% if request.id in mentorships_applied_ids %}
                                        <span class="status-postule">â— PostulÃ©</span>
                                    {% endif %}
                                </label>
                            </li>
                        {% endfor %}
                    </ul>
                    <button type="submit" class="btn-apply">ğŸ“¤ Postuler aux demandes sÃ©lectionnÃ©es</button>
                </form>
            {% else %}
                <p>Aucune demande de mentorat pour le moment.</p>
            {% endif %}
        </section>

    </main>

    <footer class="dashboard-footer">
        <p>&copy; 2025 Mentorship - Espace Ã©tudiant</p>
    </footer>

    {% if messages %}
    <script>
        Swal.fire({
            toast: true,
            position: 'bottom-end',
            icon: 'success',
            title: 'ğŸ‰ Action rÃ©alisÃ©e avec succÃ¨s !',
            showConfirmButton: false,
            timer: 3000
        });
    </script>
    {% endif %}
</body>
</html>
